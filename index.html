/**
* @OnlyCurrentDoc
* ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«åŸºã¥ãGoogleã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚
* Version: 17.0 (Generalized Version)
* Prompt Design: ã¾ã˜ã‚“å¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
* Author: Googleã‚¹ãƒ©ã‚¤ãƒ‰è‡ªå‹•ç”Ÿæˆãƒã‚¹ã‚¿ãƒ¼
* Description: æŒ‡å®šã•ã‚ŒãŸslideDataé…åˆ—ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¨­å®šã«åŸºã¥ãã€Googleã®ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡ã«æº–æ‹ ã—ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
*/


// --- 1. å®Ÿè¡Œè¨­å®š ---
const SETTINGS = {
SHOULD_CLEAR_ALL_SLIDES: true,
TARGET_PRESENTATION_ID: null
};

// --- 2. ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š (Pixel Perfect Ver.) ---
const CONFIG = {
BASE_PX: { W: 960, H: 540 },

// ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®åŸºæº–ã¨ãªã‚‹ä¸å¤‰ã®pxå€¤
POS_PX: {
titleSlide: {
logo:Â  Â  Â  Â { left: 55,Â  top: 105,Â  width: 135 },
title:Â  Â  Â  { left: 50,Â  top: 200, width: 830, height: 90 },
date:Â  Â  Â  Â { left: 50,Â  top: 450, width: 250, height: 40 },
},

// å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤å„ã‚¹ãƒ©ã‚¤ãƒ‰Â Â 
contentSlide: {Â Â 
Â  headerLogo:Â  Â  Â { right: 20, top: 20, width: 75 },Â Â 
Â  title:Â  Â  Â  Â  Â  { left: 25, top: 50,Â  width: 830, height: 65 },Â Â 
Â  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },Â Â 
Â  subhead:Â  Â  Â  Â  { left: 25, top: 130, width: 830, height: 40 },Â Â 
Â  body:Â  Â  Â  Â  Â  Â { left: 25, top: 172, width: 910, height: 290 },Â Â 
Â  twoColLeft:Â  Â  Â { left: 25,Â  top: 172, width: 440, height: 290 },Â Â 
Â  twoColRight:Â  Â  { left: 495, top: 172, width: 440, height: 290 }Â Â 
},Â Â 
processSlide: {Â Â 
Â  headerLogo:Â  Â  Â { right: 20, top: 20, width: 75 },Â Â 
Â  title:Â  Â  Â  Â  Â  { left: 25, top: 50,Â  width: 830, height: 65 },Â Â 
Â  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },Â Â 
Â  subhead:Â  Â  Â  Â  { left: 25, top: 130, width: 830, height: 40 },Â Â 
Â  area:Â  Â  Â  Â  Â  Â { left: 25, top: 152, width: 910, height: 290 }Â Â 
},Â Â 
cardsSlide: { // This POS_PX is used by both cards and headerCards
Â  headerLogo:Â  Â  Â { right: 20, top: 20, width: 75 },Â Â 
Â  title:Â  Â  Â  Â  Â  { left: 25, top: 50,Â  width: 830, height: 65 },Â Â 
Â  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },Â Â 
Â  subhead:Â  Â  Â  Â  { left: 25, top: 130, width: 830, height: 40 },Â Â 
Â  gridArea:Â  Â  Â  Â { left: 25, top: 160, width: 910, height: 290 }Â Â 
},Â Â 
sectionSlide: {Â Â 
Â  title:Â  Â  Â  { left: 55, top: 230, width: 840, height: 80 },Â Â 
Â  ghostNum:Â  Â { left: 35, top: 120, width: 400, height: 200 }
},

footer: {Â Â 
Â  leftText:Â  { left: 15, top: 505, width: 250, height: 20 },Â Â 
Â  rightPage: { right: 15, top: 505, width: 50,Â  height: 20 }Â Â 
},Â Â 
bottomBar: { left: 0, top: 534, width: 960, height: 6 }Â Â 

},

FONTS: {
family: 'Arial', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰å‹•çš„ã«å¤‰æ›´å¯èƒ½
sizes: {
title: 40, date: 16, sectionTitle: 38, contentTitle: 28, subhead: 18,
body: 14, footer: 9, chip: 11, laneTitle: 13, small: 10,
processStep: 14, axis: 12, ghostNum: 180
}
},
COLORS: {
primary_color: '#4285F4', text_primary: '#333333', background_white: '#FFFFFF',
background_gray: '#f8f9fa', faint_gray: '#e8eaed', lane_title_bg: '#f8f9fa',
table_header_bg: '#f8f9fa', lane_border: '#dadce0', card_bg: '#ffffff',
card_border: '#dadce0', neutral_gray: '#9e9e9e', ghost_gray: '#efefed'
},
DIAGRAM: {
laneGap_px: 24, lanePad_px: 10, laneTitle_h_px: 30, cardGap_px: 12,
cardMin_h_px: 48, cardMax_h_px: 70, arrow_h_px: 10, arrowGap_px: 8
},

LOGOS: {
header: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/640px-Google_2015_logo.svg.png',
closing: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/640px-Google_2015_logo.svg.png'
},

FOOTER_TEXT: `Â© ${new Date().getFullYear()} Google Inc.`
};

// --- 3. ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼šå¿…ãšç½®æ›ã—ã¦ãã ã•ã„ï¼‰ ---
const slideData = [
  { type: 'title', title: 'æ–°è¦æ¡ç”¨è€…æ•™è‚²ã¨æ—¢å­˜ä½“åˆ¶ã®æ”¹å–„è¨ˆç”»', date: '2025.09.18', notes: 'æœ¬æ—¥ã¯ã€æ–°è¦æ¡ç”¨è€…ã®æ•™è‚²è¨ˆç”»ã¨ã€ãã‚Œã«ä¼´ã†æ—¢å­˜æ•™è‚²ä½“åˆ¶ã®æ”¹å–„ç‚¹ã«ã¤ã„ã¦ã”å ±å‘Šã—ã¾ã™ã€‚' },
  { type: 'content', title: 'æœ¬æ—¥ãŠä¼ãˆã™ã‚‹ã“ã¨', points: ['æ–°è¦æ¡ç”¨è€…ã®é…å±ã¨æ•™è‚²è¨ˆç”»', 'æ—¢å­˜æ•™è‚²ä½“åˆ¶ã®èª²é¡Œã¨æ”¹å–„', 'ä»Šå¾Œã®å±•æœ›ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³'], notes: 'æœ¬æ—¥ã¯ã“ã¡ã‚‰ã®3ã¤ã®ç« ç«‹ã¦ã§ã”èª¬æ˜ã—ã¾ã™ã€‚ã¾ãšæ–°è¦æ¡ç”¨è€…ã®è¨ˆç”»ã€æ¬¡ã«æ—¢å­˜ä½“åˆ¶ã®èª²é¡Œã€æœ€å¾Œã«ä»Šå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã§ã™ã€‚' },
  { type: 'section', title: '1. æ–°è¦æ¡ç”¨è€…ã®é…å±ã¨æ•™è‚²è¨ˆç”»', notes: 'æœ€åˆã®ç« ã§ã¯ã€æ–°è¦æ¡ç”¨è€…ã®é…å±ã¨å…·ä½“çš„ãªæ•™è‚²è¨ˆç”»ã«ã¤ã„ã¦ã”èª¬æ˜ã—ã¾ã™ã€‚' },
  {
    type: 'bulletCards',
    title: 'æ–°è¦æ¡ç”¨è€…ã®å€‹åˆ¥æ•™è‚²ãƒ—ãƒ©ãƒ³',
    subhead: 'å¤–åŠã‚»ã‚¯ã‚·ãƒ§ãƒ³é…å±ã®2åã«å¯¾ã™ã‚‹å€‹åˆ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ',
    items: [
      {
        title: 'é•·äº•æ°ã¸ã®æ•™è‚²ãƒ—ãƒ©ãƒ³',
        desc: 'æ‹…å½“ã¯**å²©ç«‹æ°**ã€‚ä½¿ç”¨æ©Ÿç¨®ã®é•ã„ã‚’è€ƒæ…®ã—ã€[[æ—§ãƒ›ãƒŸã‚¹ã®æ“ä½œ]]ã«é‡ç‚¹ã‚’ç½®ã„ãŸæŒ‡å°ã‚’å®Ÿæ–½'
      },
      {
        title: 'æ‰‹å¡šæ°ã¸ã®æ•™è‚²ãƒ—ãƒ©ãƒ³',
        desc: 'æ‹…å½“ã¯**æ‘ä¸Šæ°**ã€‚[[é›»å­ã‚«ãƒ«ãƒ†æ“ä½œ]]ã¾ãŸã¯[[æ­£ã—ã„ç®—å®šæ–¹æ³•]]ã«ç„¦ç‚¹ã‚’å½“ã¦ãŸæŒ‡å°ã‚’å®Ÿæ–½'
      },
      {
        title: 'å…±é€šã‚µãƒãƒ¼ãƒˆä½“åˆ¶',
        desc: 'æ‹…å½“è€…ä¸åœ¨æ™‚ã¯**ç›¸é¦¬ã²ã¨ã¿æ°**ãŒã‚µãƒãƒ¼ãƒˆã€‚æœ¬éƒ·/è…°ãƒ¶è°·å‹¤å‹™ã‚‚è€ƒæ…®ã—ãŸæŸ”è»Ÿãªä½“åˆ¶'
      }
    ],
    notes: 'ã¾ãšã€æ–°è¦æ¡ç”¨è€…ã§ã‚ã‚‹é•·äº•æ§˜ã¨æ‰‹å¡šæ§˜ã®æ•™è‚²ãƒ—ãƒ©ãƒ³ã§ã™ã€‚ãŠäºŒäººã¯å¤–åŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸é…å±ã¨ãªã‚Šã¾ã™ãŒã€ãã‚Œãã‚Œä½¿ç”¨ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ãŒç•°ãªã‚‹ãŸã‚ã€å€‹åˆ¥æ‹…å½“åˆ¶ã§æ•™è‚²ã‚’é€²ã‚ã¾ã™ã€‚é•·äº•æ§˜ã¯å²©ç«‹ã•ã‚“ã€æ‰‹å¡šæ§˜ã¯æ‘ä¸Šã•ã‚“ãŒæ‹…å½“ã—ã¾ã™ã€‚ã¾ãŸã€å…±é€šã®ã‚µãƒãƒ¼ãƒˆã¨ã—ã¦ç›¸é¦¬ã•ã‚“ãŒæ‹…å½“è€…ä¸åœ¨æ™‚ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã™ã€‚'
  },
  {
    type: 'process',
    title: '5æ—¥é–“ã®åˆæœŸç ”ä¿®è¨ˆç”»',
    subhead: 'ç†è§£åº¦ã‚’å¯è¦–åŒ–ã—ã€ç€å®Ÿãªã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚’ä¿ƒã™',
    steps: [
      'ç®—å®šç®¡ç†é‡ã®ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆä½œæˆ',
      'ç ”ä¿®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç­–å®šï¼ˆ5æ—¥é–“ï¼‰',
      'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨å’æ¥­åŸºæº–ã®é€£æº',
      'é€²æ—çŠ¶æ³ã®å®šæœŸçš„ãªç¢ºèª',
      'ç¿’ç†Ÿåº¦ã«å¿œã˜ãŸå€‹åˆ¥ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—'
    ],
    notes: 'å…·ä½“çš„ãªç ”ä¿®è¨ˆç”»ã¨ã—ã¦ã€ã“ã¡ã‚‰ã®5ã‚¹ãƒ†ãƒƒãƒ—ã‚’äºˆå®šã—ã¦ã„ã¾ã™ã€‚ç®—å®šç®¡ç†é‡ã®ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã‚’ç”¨ã„ã¦ç†è§£åº¦ã‚’ç¢ºèªã—ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨å’æ¥­åŸºæº–ã‚’æ˜ç¢ºã«é€£æºã•ã›ã‚‹ã“ã¨ã§ã€ç€å®Ÿãªã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚'
  },
  { type: 'section', title: '2. æ—¢å­˜æ•™è‚²ä½“åˆ¶ã®èª²é¡Œã¨æ”¹å–„', notes: 'æ¬¡ã«ã€æ—¢å­˜ã®æ•™è‚²ä½“åˆ¶ã«ãŠã‘ã‚‹èª²é¡Œã¨ã€ãã®æ”¹å–„ç­–ã«ã¤ã„ã¦ã”èª¬æ˜ã—ã¾ã™ã€‚' },
  {
    type: 'content',
    title: 'æ–°ã‚·ã‚¹ãƒ†ãƒ å°å…¥ã«ä¼´ã†æ•™è‚²ä½“åˆ¶ã®å¼·åŒ–',
    subhead: 'æ–°ãƒ›ãƒŸã‚¹å°å…¥æ‹¡å¤§ã‚’è¦‹æ®ãˆãŸå¯¾å¿œ',
    points: [
      '[[æ•™è‚²å¯¾è±¡è€…ã®æ‹¡å¤§]]: å¤–åŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã®æ–°ãƒ›ãƒŸã‚¹å°å…¥å¢—åŠ ã®å¯èƒ½æ€§',
      '[[å®Ÿè·µé‡è¦–ã®æ•™è‚²]]: ãƒ‡ãƒ¢ç’°å¢ƒã®åˆ¶é™ã‹ã‚‰ã€å®Ÿç’°å¢ƒã§ã®çµŒé¨“ãŒé‡è¦',
      '[[ç†è§£åº¦ã®æ·±æ˜ã‚Š]]: æ–°ã‚·ãƒ¼ãƒˆã‚’ç”¨ã„ã¦å€‹ã€…ã®ç¿’ç†Ÿåº¦ã‚’æ­£ç¢ºã«æŠŠæ¡ã—æŒ‡å°'
    ],
    notes: 'æ¬¡ã«ã€æ—¢å­˜æ•™è‚²ä½“åˆ¶ã®èª²é¡Œã§ã™ã€‚ç‰¹ã«ã€æ–°ãƒ›ãƒŸã‚¹ã®å°å…¥ãŒæ‹¡å¤§ã—ã¦ãŠã‚Šã€æ•™è‚²å¯¾è±¡è€…ãŒå¢—ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¢ç’°å¢ƒã«åˆ¶é™ãŒã‚ã‚‹ãŸã‚ã€å®Ÿç’°å¢ƒã§ã®OJTã‚’é‡è¦–ã—ã€æ–°ã—ã„ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã§å€‹ã€…ã®ç†è§£åº¦ã‚’æ·±æ˜ã‚Šã—ã¦ã„ãæ–¹é‡ã§ã™ã€‚'
  },
  {
    type: 'cards',
    title: 'ãã®ä»–æ•™è‚²èª²é¡Œã¨é–¢é€£æ¥­å‹™',
    columns: 3,
    items: [
      {
        title: 'é‡ç‚¹æ•™è‚²é …ç›®ã®ç¢ºèª',
        desc: 'åœ¨å®…è‡ªå·±æ³¨å°„ç®¡ç†æ–™ã«é–¢ã™ã‚‹ç†è§£åº¦ã®å†ç¢ºèªã¨å¾¹åº•'
      },
      {
        title: 'ç¶™ç¶šçš„ãªè©•ä¾¡ã¨FB',
        desc: 'è‹¥æ—æ°ã®é…å±çŠ¶æ³ã¨è©•ä¾¡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®è­°è«–ã‚’ç¶™ç¶š'
      },
      {
        title: 'æ¥­å‹™å¼•ãç¶™ãã®å®Ÿæ–½',
        desc: 'å²¡éƒ¨æ°ã®ç•°å‹•ã«ä¼´ã†æ¡ç”¨æ¥­å‹™ã‚’2äººä½“åˆ¶ã§ç¢ºå®Ÿã«å¼•ãç¶™ã'
      }
    ],
    notes: 'ãã®ä»–ã€åœ¨å®…è‡ªå·±æ³¨å°„ç®¡ç†æ–™ã®ç†è§£åº¦ç¢ºèªã‚„ã€è‹¥æ—æ§˜ã®è©•ä¾¡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã€å²¡éƒ¨æ§˜ã®ç•°å‹•ã«ä¼´ã†æ¡ç”¨æ¥­å‹™ã®å¼•ãç¶™ããªã©ã€é–¢é€£æ¥­å‹™ã‚‚ä¸¦è¡Œã—ã¦é€²ã‚ã¦ã¾ã„ã‚Šã¾ã™ã€‚'
  },
  { type: 'section', title: '3. ä»Šå¾Œã®å±•æœ›ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³', notes: 'æœ€å¾Œã®ç« ã§ã¯ã€æ•™è‚²éƒ¨é–€ã®ç›®æ¨™ã¨ã€å…·ä½“çš„ãªæ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦å…±æœ‰ã—ã¾ã™ã€‚' },
  {
    type: 'content',
    title: 'æ•™è‚²éƒ¨é–€ã®ä»ŠæœŸç›®æ¨™',
    subhead: 'å‰å¹´åº¦ã®æ–¹é‡ã‚’è¸è¥²ã—ã€å®šç€æ”¯æ´ã‚’å¼·åŒ–',
    points: [
      '**åŸºæœ¬æ–¹é‡**: å‰å¹´åº¦ã®ç›®æ¨™è¨­å®šã¨æ–¹é‡ã‚’è¸è¥²',
      '**æ‘ä¸Šæ°ã®æ„æ¬²**: [[æ–°å…¥ç¤¾å“¡ãŒé•·ãåƒãç¶šã‘ã‚‰ã‚Œã‚‹ç’°å¢ƒä½œã‚Š]]ã¸ã®è²¢çŒ®',
      '**ä½“åˆ¶å¼·åŒ–**: æ•™è‚²æ‹…å½“è€…é–“ã®é€£æºã‚’å¯†ã«ã—ã€ã‚µãƒãƒ¼ãƒˆä½“åˆ¶ã‚’å……å®Ÿ'
    ],
    notes: 'æ•™è‚²éƒ¨é–€ã®ä»ŠæœŸç›®æ¨™ã¯ã€åŸºæœ¬çš„ã«ã¯å‰å¹´åº¦ã®æ–¹é‡ã‚’è¸è¥²ã—ã¾ã™ã€‚æ‘ä¸Šã•ã‚“ã‹ã‚‰ã¯ã€æ–°å…¥ç¤¾å“¡ãŒå®‰å¿ƒã—ã¦é•·ãåƒã‘ã‚‹ç’°å¢ƒä½œã‚Šã«è²¢çŒ®ã—ãŸã„ã¨ã®åŠ›å¼·ã„ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ãŸã ã„ã¦ã„ã¾ã™ã€‚'
  },
  {
    type: 'headerCards',
    title: 'æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (Next Action)',
    columns: 2,
    items: [
      {
        title: 'ä»Šäº• ç¨” æ° â†’ æ‘ä¸Š ã¯ã‚‹ã¿ æ°',
        desc: 'è‹¥æ—æ°ã¨å¯Œé•·æ°ã«é–¢ã™ã‚‹[[ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è³‡æ–™ã®å…±æœ‰]]'
      },
      {
        title: 'ä»Šäº• ç¨” æ° â†’ åœŸç”° æ°',
        desc: 'æ¡ç”¨ãƒãƒ£ãƒƒãƒˆã¸[[æ‘ä¸Šã¯ã‚‹ã¿æ°ã‚’è¿½åŠ ]]ã™ã‚‹ã‚ˆã†ç›¸è«‡'
      }
    ],
    notes: 'æœ€å¾Œã«ã€å…·ä½“çš„ãªæ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚ç§ã‹ã‚‰æ‘ä¸Šã•ã‚“ã¸è‹¥æ—æ§˜ã¨å¯Œé•·æ§˜ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è³‡æ–™ã‚’å…±æœ‰ã—ã¾ã™ã€‚ã¾ãŸã€åœŸç”°ã•ã‚“ã«ã”ç›¸è«‡ã®ä¸Šã€æ‘ä¸Šã•ã‚“ã‚’æ¡ç”¨é–¢é€£ã®ãƒãƒ£ãƒƒãƒˆã«ã”æ‹›å¾…ã—ã¾ã™ã€‚'
  },
  { type: 'closing', notes: 'ã”æ¸…è´ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ã”è³ªå•ãªã©ã”ã–ã„ã¾ã—ãŸã‚‰ã€ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚' }
];


// --- 4. ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼‰ ---
let __SECTION_COUNTER = 0; // ç« ç•ªå·ã‚«ã‚¦ãƒ³ã‚¿ï¼ˆã‚´ãƒ¼ã‚¹ãƒˆæ•°å­—ç”¨ï¼‰

/**
Â * ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆã®ãƒ¡ã‚¤ãƒ³é–¢æ•°
Â * å®Ÿè¡Œæ™‚é–“: ç´„3-6åˆ†
Â * æœ€å¤§ã‚¹ãƒ©ã‚¤ãƒ‰æ•°: 50æš
Â */
function generatePresentation() {
Â  const userSettings = PropertiesService.getScriptProperties().getProperties();
Â  if (userSettings.primaryColor) CONFIG.COLORS.primary_color = userSettings.primaryColor;
Â  if (userSettings.footerText) CONFIG.FOOTER_TEXT = userSettings.footerText;
Â  if (userSettings.headerLogoUrl) CONFIG.LOGOS.header = userSettings.headerLogoUrl;
Â  if (userSettings.closingLogoUrl) CONFIG.LOGOS.closing = userSettings.closingLogoUrl;
Â  if (userSettings.fontFamily) CONFIG.FONTS.family = userSettings.fontFamily;

Â  let presentation;
Â  try {
Â  Â  presentation = SETTINGS.TARGET_PRESENTATION_ID
Â  Â  Â  ? SlidesApp.openById(SETTINGS.TARGET_PRESENTATION_ID)
Â  Â  Â  : SlidesApp.getActivePresentation();
Â  Â  if (!presentation) throw new Error('å¯¾è±¡ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');

Â  Â  if (SETTINGS.SHOULD_CLEAR_ALL_SLIDES) {
Â  Â  Â  const slides = presentation.getSlides();
Â  Â  Â  for (let i = slides.length - 1; i >= 0; i--) slides[i].remove();
Â  Â  }

Â  Â  __SECTION_COUNTER = 0;

Â  Â  const layout = createLayoutManager(presentation.getPageWidth(), presentation.getPageHeight());

Â  Â  let pageCounter = 0;
Â  Â  for (const data of slideData) {
Â  Â  Â  try {
Â  Â  Â  Â  const generator = slideGenerators[data.type];
Â  Â  Â  Â  if (data.type !== 'title' && data.type !== 'closing') pageCounter++;
Â  Â  Â  Â  if (generator) {
Â  Â  Â  Â  Â  const slide = presentation.appendSlide(SlidesApp.PredefinedLayout.BLANK);
Â  Â  Â  Â  Â  generator(slide, data, layout, pageCounter);

Â  Â  Â  Â  Â  if (data.notes) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  const notesShape = slide.getNotesPage().getSpeakerNotesShape();
Â  Â  Â  Â  Â  Â  Â  if (notesShape) {
Â  Â  Â  Â  Â  Â  Â  Â  notesShape.getText().setText(data.notes);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Logger.log(`ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒˆã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Logger.log(`ã‚¹ãƒ©ã‚¤ãƒ‰ã®ç”Ÿæˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ (ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ)ã€‚ Type: ${data.type}, Title: ${data.title || 'N/A'}, Error: ${e.message}`);
Â  Â  Â  }
Â  Â  }

Â  } catch (e) {
Â  Â  Logger.log(`å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸ: ${e.message}\nStack: ${e.stack}`);
Â  }
}

// --- 5. ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¨­å®šé–¢æ•° ---
function onOpen(e) {
Â  SlidesApp.getUi()
Â  Â  .createMenu('ã‚«ã‚¹ã‚¿ãƒ è¨­å®š')
Â  Â  .addItem('ğŸ¨ ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆ', 'generatePresentation')
Â  Â  .addSeparator()
Â  Â  .addSubMenu(SlidesApp.getUi().createMenu('âš™ï¸ è¨­å®š')
Â  Â  Â  .addItem('ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼', 'setPrimaryColor')
Â  Â  Â  .addItem('ãƒ•ã‚©ãƒ³ãƒˆ', 'setFont')
Â  Â  Â  .addItem('ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ', 'setFooterText')
Â  Â  Â  .addItem('ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´', 'setHeaderLogo')
Â  Â  Â  .addItem('ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒ­ã‚´', 'setClosingLogo'))
Â  Â  .addItem('ğŸ”„ ãƒªã‚»ãƒƒãƒˆ', 'resetSettings')
Â  Â  .addToUi();
}

// ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼è¨­å®š
function setPrimaryColor() {
Â  const ui = SlidesApp.getUi();
Â  const props = PropertiesService.getScriptProperties();
Â  const currentValue = props.getProperty('primaryColor') || '#4285F4';
Â Â 
Â  const result = ui.prompt(
Â  Â  'ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼è¨­å®š',
Â  Â  `ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: #4285F4ï¼‰\nç¾åœ¨å€¤: ${currentValue}\n\nç©ºæ¬„ã§æ—¢å®šå€¤ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚`,
Â  Â  ui.ButtonSet.OK_CANCEL
Â  );
Â Â 
Â  if (result.getSelectedButton() === ui.Button.OK) {
Â  Â  const value = result.getResponseText().trim();
Â  Â  if (value === '') {
Â  Â  Â  props.deleteProperty('primaryColor');
Â  Â  Â  ui.alert('ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
Â  Â  } else {
Â  Â  Â  props.setProperty('primaryColor', value);
Â  Â  Â  ui.alert('ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
Â  Â  }
Â  }
}

// ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å½¢å¼ï¼‰
function setFont() {
Â  const ui = SlidesApp.getUi();
Â  const props = PropertiesService.getScriptProperties();
Â  const currentValue = props.getProperty('fontFamily') || 'Arial';
Â Â 
Â  const fonts = [
Â  Â  'Arial',
Â  Â  'Noto Sans JP',
Â  Â  'M PLUS 1p',
Â  Â  'Noto Serif JP'
Â  ];
Â Â 
Â  const fontList = fonts.map((font, index) =>Â 
Â  Â  `${index + 1}. ${font}${font === currentValue ? ' (ç¾åœ¨)' : ''}`
Â  ).join('\n');
Â Â 
Â  const result = ui.prompt(
Â  Â  'ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š',
Â  Â  `ä½¿ç”¨ã™ã‚‹ãƒ•ã‚©ãƒ³ãƒˆã®ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:\n\n${fontList}\n\nâ€» ç©ºæ¬„ã§æ—¢å®šå€¤ï¼ˆArialï¼‰ã«ãƒªã‚»ãƒƒãƒˆ`,
Â  Â  ui.ButtonSet.OK_CANCEL
Â  );
Â Â 
Â  if (result.getSelectedButton() === ui.Button.OK) {
Â  Â  const input = result.getResponseText().trim();
Â  Â  if (input === '') {
Â  Â  Â  props.deleteProperty('fontFamily');
Â  Â  Â  ui.alert('ãƒ•ã‚©ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼ˆArialï¼‰ã€‚');
Â  Â  } else {
Â  Â  Â  const index = parseInt(input) - 1;
Â  Â  Â  if (index >= 0 && index < fonts.length) {
Â  Â  Â  Â  props.setProperty('fontFamily', fonts[index]);
Â  Â  Â  Â  ui.alert(`ãƒ•ã‚©ãƒ³ãƒˆã‚’ã€Œ${fonts[index]}ã€ã«è¨­å®šã—ã¾ã—ãŸã€‚`);
Â  Â  Â  } else {
Â  Â  Â  Â  ui.alert('ç„¡åŠ¹ãªç•ªå·ã§ã™ã€‚è¨­å®šã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚');
Â  Â  Â  }
Â  Â  }
Â  }
}

// ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š
function setFooterText() {
Â  const ui = SlidesApp.getUi();
Â  const props = PropertiesService.getScriptProperties();
Â  const currentValue = props.getProperty('footerText') || 'æœªè¨­å®š';
Â Â 
Â  const result = ui.prompt(
Â  Â  'ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š',
Â  Â  `ãƒ•ãƒƒã‚¿ãƒ¼ã«è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nç¾åœ¨å€¤: ${currentValue}\n\nç©ºæ¬„ã§ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚`,
Â  Â  ui.ButtonSet.OK_CANCEL
Â  );
Â Â 
Â  if (result.getSelectedButton() === ui.Button.OK) {
Â  Â  const value = result.getResponseText().trim();
Â  Â  if (value === '') {
Â  Â  Â  props.deleteProperty('footerText');
Â  Â  Â  ui.alert('ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
Â  Â  } else {
Â  Â  Â  props.setProperty('footerText', value);
Â  Â  Â  ui.alert('ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
Â  Â  }
Â  }
}

// ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´è¨­å®š
function setHeaderLogo() {
Â  const ui = SlidesApp.getUi();
Â  const props = PropertiesService.getScriptProperties();
Â  const currentValue = props.getProperty('headerLogoUrl') || 'æœªè¨­å®š';
Â Â 
Â  const result = ui.prompt(
Â  Â  'ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´è¨­å®š',
Â  Â  `ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nç¾åœ¨å€¤: ${currentValue}\n\nç©ºæ¬„ã§ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚`,
Â  Â  ui.ButtonSet.OK_CANCEL
Â  );
Â Â 
Â  if (result.getSelectedButton() === ui.Button.OK) {
Â  Â  const value = result.getResponseText().trim();
Â  Â  if (value === '') {
Â  Â  Â  props.deleteProperty('headerLogoUrl');
Â  Â  Â  ui.alert('ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
Â  Â  } else {
Â  Â  Â  props.setProperty('headerLogoUrl', value);
Â  Â  Â  ui.alert('ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
Â  Â  }
Â  }
}

// ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒ­ã‚´è¨­å®š
function setClosingLogo() {
Â  const ui = SlidesApp.getUi();
Â  const props = PropertiesService.getScriptProperties();
Â  const currentValue = props.getProperty('closingLogoUrl') || 'æœªè¨­å®š';
Â Â 
Â  const result = ui.prompt(
Â  Â  'ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒ­ã‚´è¨­å®š',
Â  Â  `ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã®ãƒ­ã‚´URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nç¾åœ¨å€¤: ${currentValue}\n\nç©ºæ¬„ã§ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚`,
Â  Â  ui.ButtonSet.OK_CANCEL
Â  );
Â Â 
Â  if (result.getSelectedButton() === ui.Button.OK) {
Â  Â  const value = result.getResponseText().trim();
Â  Â  if (value === '') {
Â  Â  Â  props.deleteProperty('closingLogoUrl');
Â  Â  Â  ui.alert('ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒ­ã‚´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
Â  Â  } else {
Â  Â  Â  props.setProperty('closingLogoUrl', value);
Â  Â  Â  ui.alert('ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒ­ã‚´ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
Â  Â  }
Â  }
}

function resetSettings() {
Â  const ui = SlidesApp.getUi();
Â  const result = ui.alert('è¨­å®šã®ãƒªã‚»ãƒƒãƒˆ', 'ã™ã¹ã¦ã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ', ui.ButtonSet.YES_NO);
Â Â 
Â  if (result === ui.Button.YES) {
Â  Â  PropertiesService.getScriptProperties().deleteAllProperties();
Â  Â  ui.alert('ã™ã¹ã¦ã®è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚\n\nâ€¢ ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼: #4285F4\nâ€¢ ãƒ•ã‚©ãƒ³ãƒˆ: Arial\nâ€¢ ãƒ•ãƒƒã‚¿ãƒ¼/ãƒ­ã‚´: æœªè¨­å®š');
Â  }
}

// --- 6. ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒãƒ£ ---
const slideGenerators = {
Â  title: createTitleSlide,
Â  section: createSectionSlide,
Â  content: createContentSlide,
Â  process: createProcessSlide,
Â  cards: createCardsSlide,
Â  headerCards: createHeaderCardsSlide,
Â  bulletCards: createBulletCardsSlide,
Â  closing: createClosingSlide,
};

// --- 7. ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆé–¢æ•°ç¾¤ ---
function createTitleSlide(slide, data, layout) {
Â  slide.getBackground().setSolidFill(CONFIG.COLORS.background_white);

Â  const logoRect = layout.getRect('titleSlide.logo');
Â  try {
Â  Â  const logo = slide.insertImage(CONFIG.LOGOS.header);
Â  Â  const aspect = logo.getHeight() / logo.getWidth();
Â  Â  logo.setLeft(logoRect.left).setTop(logoRect.top).setWidth(logoRect.width).setHeight(logoRect.width * aspect);
Â  } catch (e) {
Â  Â  // ç”»åƒæŒ¿å…¥ã«å¤±æ•—ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ä»–ã®è¦ç´ ã‚’æç”»
Â  }

Â  const titleRect = layout.getRect('titleSlide.title');
Â  const titleShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, titleRect.left, titleRect.top, titleRect.width, titleRect.height);
Â  setStyledText(titleShape, data.title, { size: CONFIG.FONTS.sizes.title, bold: true });

Â  const dateRect = layout.getRect('titleSlide.date');
Â  const dateShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, dateRect.left, dateRect.top, dateRect.width, dateRect.height);
Â  dateShape.getText().setText(data.date || '');
Â  applyTextStyle(dateShape.getText(), { size: CONFIG.FONTS.sizes.date });

Â  drawBottomBar(slide, layout);
}

function createSectionSlide(slide, data, layout, pageNum) {
Â  slide.getBackground().setSolidFill(CONFIG.COLORS.background_gray);

Â  // é€ã‹ã—ç•ªå·ï¼šsectionNo > ã‚¿ã‚¤ãƒˆãƒ«å…ˆé ­ã®æ•°å­— > è‡ªå‹•é€£ç•ª
Â  __SECTION_COUNTER++;
Â  const parsedNum = (() => {
Â  Â  if (Number.isFinite(data.sectionNo)) return Number(data.sectionNo);
Â  Â  const m = String(data.title || '').match(/^\s*(\d+)[\.ï¼]/);
Â  Â  return m ? Number(m[1]) : __SECTION_COUNTER;
Â  })();
Â  const num = String(parsedNum).padStart(2, '0');

Â  const ghostRect = layout.getRect('sectionSlide.ghostNum');
Â  const ghost = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, ghostRect.left, ghostRect.top, ghostRect.width, ghostRect.height);
Â  ghost.getText().setText(num);
Â  applyTextStyle(ghost.getText(), { size: CONFIG.FONTS.sizes.ghostNum, color: CONFIG.COLORS.ghost_gray, bold: true });
Â  try { ghost.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE); } catch(e) {}

Â  const titleRect = layout.getRect('sectionSlide.title');
Â  const titleShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, titleRect.left, titleRect.top, titleRect.width, titleRect.height);
Â  titleShape.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE);
Â  setStyledText(titleShape, data.title, { size: CONFIG.FONTS.sizes.sectionTitle, bold: true, align: SlidesApp.ParagraphAlignment.CENTER });

Â  addCucFooter(slide, layout, pageNum);
}

// contentï¼ˆ1/2ã‚«ãƒ©ãƒ  + å°è¦‹å‡ºã— + ç”»åƒï¼‰
function createContentSlide(slide, data, layout, pageNum) {
Â  slide.getBackground().setSolidFill(CONFIG.COLORS.background_white);
Â  drawStandardTitleHeader(slide, layout, 'contentSlide', data.title);
Â  const dy = drawSubheadIfAny(slide, layout, 'contentSlide', data.subhead);

Â  // ã‚¢ã‚¸ã‚§ãƒ³ãƒ€å®‰å…¨è£…ç½®
Â  const isAgenda = isAgendaTitle(data.title || '');
Â  let points = Array.isArray(data.points) ? data.points.slice(0) : [];
Â  if (isAgenda && (!points || points.length === 0)) {
Â  Â  points = buildAgendaFromSlideData();
Â  Â  if (points.length === 0) points = ['æœ¬æ—¥ã®ç›®çš„', 'é€²ã‚æ–¹', 'æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³'];
Â  }

Â  const hasImages = Array.isArray(data.images) && data.images.length > 0;
Â  const isTwo = !!(data.twoColumn || data.columns);

Â  if ((isTwo && (data.columns || points)) || (!isTwo && points && points.length > 0)) {
Â  Â  if (isTwo) {
Â  Â  Â  let L = [], R = [];
Â  Â  Â  if (Array.isArray(data.columns) && data.columns.length === 2) {
Â  Â  Â  Â  L = data.columns[0] || []; R = data.columns[1] || [];
Â  Â  Â  } else {
Â  Â  Â  Â  const mid = Math.ceil(points.length / 2);
Â  Â  Â  Â  L = points.slice(0, mid); R = points.slice(mid);
Â  Â  Â  }
Â  Â  Â  const leftRect = offsetRect(layout.getRect('contentSlide.twoColLeft'), 0, dy);
Â  Â  Â  const rightRect = offsetRect(layout.getRect('contentSlide.twoColRight'), 0, dy);
Â  Â  Â  const leftShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, leftRect.left, leftRect.top, leftRect.width, leftRect.height);
Â  Â  Â  const rightShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, rightRect.left, rightRect.top, rightRect.width, rightRect.height);
Â  Â  Â  setBulletsWithInlineStyles(leftShape, L);
Â  Â  Â  setBulletsWithInlineStyles(rightShape, R);
Â  Â  } else {
Â  Â  Â  const bodyRect = offsetRect(layout.getRect('contentSlide.body'), 0, dy);
Â  Â  Â  if (isAgenda) {
Â  Â  Â  Â  drawNumberedItems(slide, layout, bodyRect, points);
Â  Â  Â  } else {
Â  Â  Â  Â  const bodyShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, bodyRect.left, bodyRect.top, bodyRect.width, bodyRect.height);
Â  Â  Â  Â  setBulletsWithInlineStyles(bodyShape, points);
Â  Â  Â  }
Â  Â  }
Â  }

Â  // ç”»åƒï¼ˆä»»æ„ï¼‰
Â  if (hasImages) {
Â  Â  const area = offsetRect(layout.getRect('contentSlide.body'), 0, dy);
Â  Â  renderImagesInArea(slide, layout, area, normalizeImages(data.images));
Â  }

Â  drawBottomBarAndFooter(slide, layout, pageNum);
}

// processï¼ˆè§’æ 1pxï¼‹ä¸€æ¡æ•°å­—ï¼‰
function createProcessSlide(slide, data, layout, pageNum) {
Â  slide.getBackground().setSolidFill(CONFIG.COLORS.background_white);
Â  drawStandardTitleHeader(slide, layout, 'processSlide', data.title);
Â  const dy = drawSubheadIfAny(slide, layout, 'processSlide', data.subhead);

Â  const area = offsetRect(layout.getRect('processSlide.area'), 0, dy);
Â  const steps = Array.isArray(data.steps) ? data.steps : [];
Â  const n = Math.max(1, steps.length);

Â  const topPadding = layout.pxToPt(30);
Â  const bottomPadding = layout.pxToPt(10);
Â  const drawableHeight = area.height - topPadding - bottomPadding;
Â  const gapY = drawableHeight / Math.max(1, n - 1);
Â  const cx = area.left + layout.pxToPt(44);
Â  const top0 = area.top + topPadding;

Â  const line = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, cx - layout.pxToPt(1), top0 + layout.pxToPt(6), layout.pxToPt(2), gapY * (n - 1));
Â  line.getFill().setSolidFill(CONFIG.COLORS.faint_gray);
Â  line.getBorder().setTransparent();

Â  for (let i = 0; i < n; i++) {
Â  Â  const cy = top0 + gapY * i;
Â  Â  const sz = layout.pxToPt(28);
Â  Â  const numBox = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, cx - sz/2, cy - sz/2, sz, sz);
Â  Â  numBox.getFill().setSolidFill(CONFIG.COLORS.primary_color);
Â  Â  numBox.getBorder().setTransparent();
Â  Â  const num = numBox.getText(); num.setText(String(i + 1));
Â  Â  applyTextStyle(num, { size: 12, bold: true, color: CONFIG.COLORS.background_white, align: SlidesApp.ParagraphAlignment.CENTER });

Â  Â  // å…ƒã®ãƒ—ãƒ­ã‚»ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å…ˆé ­ã®æ•°å­—ã‚’é™¤å»
Â  Â  let cleanText = String(steps[i] || '');
Â  Â  cleanText = cleanText.replace(/^\s*\d+[\.\s]*/, '');

Â  Â  const txt = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, cx + layout.pxToPt(28), cy - layout.pxToPt(16), area.width - layout.pxToPt(70), layout.pxToPt(32));
Â  Â  setStyledText(txt, cleanText, { size: CONFIG.FONTS.sizes.processStep });
Â  Â  try { txt.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE); } catch(e){}
Â  }

Â  drawBottomBarAndFooter(slide, layout, pageNum);
}

// cardsï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ï¼‰
function createCardsSlide(slide, data, layout, pageNum) {
Â  slide.getBackground().setSolidFill(CONFIG.COLORS.background_white);
Â  drawStandardTitleHeader(slide, layout, 'cardsSlide', data.title);
Â  const dy = drawSubheadIfAny(slide, layout, 'cardsSlide', data.subhead);

Â  const area = offsetRect(layout.getRect('cardsSlide.gridArea'), 0, dy);
Â  const items = Array.isArray(data.items) ? data.items : [];
Â  const cols = Math.min(3, Math.max(2, Number(data.columns) || (items.length <= 4 ? 2 : 3)));
Â  const gap = layout.pxToPt(16);
Â  const rows = Math.ceil(items.length / cols);
Â  const cardW = (area.width - gap * (cols - 1)) / cols;
Â  const cardH = Math.max(layout.pxToPt(92), (area.height - gap * (rows - 1)) / rows);

Â  for (let idx = 0; idx < items.length; idx++) {
Â  Â  const r = Math.floor(idx / cols), c = idx % cols;
Â  Â  const left = area.left + c * (cardW + gap);
Â  Â  const topÂ  = area.topÂ  + r * (cardH + gap);

Â  Â  const card = slide.insertShape(SlidesApp.ShapeType.ROUND_RECTANGLE, left, top, cardW, cardH);
Â  Â  card.getFill().setSolidFill(CONFIG.COLORS.card_bg);
Â  Â  card.getBorder().getLineFill().setSolidFill(CONFIG.COLORS.card_border);
Â  Â  card.getBorder().setWeight(1);

Â  Â  const obj = items[idx];
Â  Â  if (typeof obj === 'string') {
Â  Â  Â  setStyledText(card, obj, { size: CONFIG.FONTS.sizes.body });
Â  Â  } else {
Â  Â  Â  const title = String(obj.title || '');
Â  Â  Â  const descÂ  = String(obj.desc || '');
Â  Â  Â Â 
Â  Â  Â  if (title.length > 0 && desc.length > 0) {
Â  Â  Â  Â  // ã‚¿ã‚¤ãƒˆãƒ« + æ”¹è¡Œ + èª¬æ˜æ–‡
Â  Â  Â  Â  const combined = `${title}\n\n${desc}`;
Â  Â  Â  Â  setStyledText(card, combined, { size: CONFIG.FONTS.sizes.body });
Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  card.getText().getRange(0, title.length).getTextStyle().setBold(true);
Â  Â  Â  Â  } catch(e){}
Â  Â  Â  } else if (title.length > 0) {
Â  Â  Â  Â  // ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿
Â  Â  Â  Â  setStyledText(card, title, { size: CONFIG.FONTS.sizes.body, bold: true });
Â  Â  Â  } else {
Â  Â  Â  Â  // èª¬æ˜æ–‡ã®ã¿ï¼ˆç¨€ãªã‚±ãƒ¼ã‚¹ï¼‰
Â  Â  Â  Â  setStyledText(card, desc, { size: CONFIG.FONTS.sizes.body });
Â  Â  Â  }
Â  Â  }
Â  Â  try { card.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE); } catch(e) {}
Â  }

Â  drawBottomBarAndFooter(slide, layout, pageNum);
}

// headerCardsï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ãã‚«ãƒ¼ãƒ‰ï¼‰
function createHeaderCardsSlide(slide, data, layout, pageNum) {
Â  slide.getBackground().setSolidFill(CONFIG.COLORS.background_white);
Â  drawStandardTitleHeader(slide, layout, 'cardsSlide', data.title);
Â  const dy = drawSubheadIfAny(slide, layout, 'cardsSlide', data.subhead);

Â  const area = offsetRect(layout.getRect('cardsSlide.gridArea'), 0, dy);
Â  const items = Array.isArray(data.items) ? data.items : [];
Â  const cols = Math.min(3, Math.max(2, Number(data.columns) || (items.length <= 4 ? 2 : 3)));
Â  const gap = layout.pxToPt(16);
Â  const rows = Math.ceil(items.length / cols);
Â  const cardW = (area.width - gap * (cols - 1)) / cols;
Â  const cardH = Math.max(layout.pxToPt(92), (area.height - gap * (rows - 1)) / rows);

Â  for (let idx = 0; idx < items.length; idx++) {
Â  Â  const r = Math.floor(idx / cols), c = idx % cols;
Â  Â  const left = area.left + c * (cardW + gap);
Â  Â  const topÂ  = area.topÂ  + r * (cardH + gap);

Â  Â  const obj = items[idx];
Â  Â  const titleText = (typeof obj === 'string') ? '' : String(obj.title || '');
Â  Â  const descText = (typeof obj === 'string') ? String(obj) : String(obj.desc || '');
Â  Â Â 
Â  Â  const headerHeight = layout.pxToPt(40);
Â  Â  const headerShape = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, left, top, cardW, headerHeight);
Â  Â  headerShape.getFill().setSolidFill(CONFIG.COLORS.primary_color);
Â  Â  headerShape.getBorder().getLineFill().setSolidFill(CONFIG.COLORS.card_border);
Â  Â  headerShape.getBorder().setWeight(1);
Â  Â Â 
Â  Â  const bodyShape = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, left, top + headerHeight, cardW, cardH - headerHeight);
Â  Â  bodyShape.getFill().setSolidFill(CONFIG.COLORS.card_bg);
Â  Â  bodyShape.getBorder().getLineFill().setSolidFill(CONFIG.COLORS.card_border);
Â  Â  bodyShape.getBorder().setWeight(1);
Â  Â Â 
Â  Â  const headerTextShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, left, top, cardW, headerHeight);
Â  Â  setStyledText(headerTextShape, titleText, { size: CONFIG.FONTS.sizes.body, bold: true, color: CONFIG.COLORS.background_white, align: SlidesApp.ParagraphAlignment.CENTER });
Â  Â  try { headerTextShape.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE); } catch(e){}

Â  Â  const bodyTextShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, left, top + headerHeight, cardW, cardH - headerHeight);
Â  Â  setStyledText(bodyTextShape, descText, { size: CONFIG.FONTS.sizes.body, align: SlidesApp.ParagraphAlignment.CENTER });
Â  Â  try { bodyTextShape.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE); } catch(e){}
Â  }

Â  drawBottomBarAndFooter(slide, layout, pageNum);
}

// bulletCardsï¼ˆç®‡æ¡æ›¸ãã‚«ãƒ¼ãƒ‰ï¼‰
function createBulletCardsSlide(slide, data, layout, pageNum) {
Â  slide.getBackground().setSolidFill(CONFIG.COLORS.background_white);
Â  drawStandardTitleHeader(slide, layout, 'contentSlide', data.title);
Â  const dy = drawSubheadIfAny(slide, layout, 'contentSlide', data.subhead);

Â  const area = offsetRect(layout.getRect('contentSlide.body'), 0, dy);
Â  const items = Array.isArray(data.items) ? data.items : [];
Â  const totalItems = Math.min(items.length, 3);
Â  if (totalItems === 0) {
Â  Â  drawBottomBarAndFooter(slide, layout, pageNum);
Â  Â  return;
Â  }

Â  const gap = layout.pxToPt(16);
Â  const minCardHeight = layout.pxToPt(90);
Â  const maxCardHeight = layout.pxToPt(120);
Â  const idealCardHeight = (area.height - (totalItems - 1) * gap) / totalItems;
Â  const cardHeight = Math.max(minCardHeight, Math.min(maxCardHeight, idealCardHeight));
Â Â 
Â  let currentY = area.top;

Â  for (let i = 0; i < totalItems; i++) {
Â  Â  const item = items[i];
Â  Â  const card = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, area.left, currentY, area.width, cardHeight);
Â  Â  card.getFill().setSolidFill(CONFIG.COLORS.background_gray);
Â  Â  card.getBorder().getLineFill().setSolidFill(CONFIG.COLORS.card_border);
Â  Â  card.getBorder().setWeight(1);

Â  Â  const padding = layout.pxToPt(20);
Â  Â  const title = String(item.title || '');
Â  Â  const desc = String(item.desc || '');
Â  Â Â 
Â  Â  if (title.length > 0 && desc.length > 0) {
Â  Â  Â  const titleShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, area.left + padding, currentY + layout.pxToPt(12), area.width - padding * 2, layout.pxToPt(18));
Â  Â  Â  titleShape.getFill().setTransparent();
Â  Â  Â  titleShape.getBorder().setTransparent();
Â  Â  Â  setStyledText(titleShape, title, { size: 14, bold: true });
Â  Â  Â Â 
Â  Â  Â  const descShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, area.left + padding, currentY + layout.pxToPt(38), area.width - padding * 2, cardHeight - layout.pxToPt(48));
Â  Â  Â  descShape.getFill().setTransparent();
Â  Â  Â  descShape.getBorder().setTransparent();
Â  Â  Â  setStyledText(descShape, desc, { size: 14, color: CONFIG.COLORS.text_primary });
Â  Â  } else if (title.length > 0) {
Â  Â  Â  const titleShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, area.left + padding, currentY, area.width - padding * 2, cardHeight);
Â  Â  Â  titleShape.getFill().setTransparent();
Â  Â  Â  titleShape.getBorder().setTransparent();
Â  Â  Â  titleShape.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE);
Â  Â  Â  setStyledText(titleShape, title, { size: 14, bold: true });
Â  Â  } else {
Â  Â  Â  const descShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, area.left + padding, currentY, area.width - padding * 2, cardHeight);
Â  Â  Â  descShape.getFill().setTransparent();
Â  Â  Â  descShape.getBorder().setTransparent();
Â  Â  Â  descShape.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE);
Â  Â  Â  setStyledText(descShape, desc, { size: 14, color: CONFIG.COLORS.text_primary });
Â  Â  }

Â  Â  currentY += cardHeight + gap;
Â  }

Â  drawBottomBarAndFooter(slide, layout, pageNum);
}

// closingï¼ˆçµã³ï¼‰
function createClosingSlide(slide, data, layout) {
slide.getBackground().setSolidFill(CONFIG.COLORS.background_white);
try {
Â  const image = slide.insertImage(CONFIG.LOGOS.closing);
Â  const imgW_pt = layout.pxToPt(450) * layout.scaleX;
Â  const aspect = image.getHeight() / image.getWidth();
Â  image.setWidth(imgW_pt).setHeight(imgW_pt * aspect);
Â  image.setLeft((layout.pageW_pt - imgW_pt) / 2).setTop((layout.pageH_pt - (imgW_pt * aspect)) / 2);
} catch (e) {
Â  // ç”»åƒæŒ¿å…¥ã«å¤±æ•—ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ä»–ã®è¦ç´ ã‚’æç”»
}
}


// --- 8. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ç¾¤ ---
function createLayoutManager(pageW_pt, pageH_pt) {
const pxToPt = (px) => px * 0.75;
const baseW_pt = pxToPt(CONFIG.BASE_PX.W);
const baseH_pt = pxToPt(CONFIG.BASE_PX.H);
const scaleX = pageW_pt / baseW_pt;
const scaleY = pageH_pt / baseH_pt;

const getPositionFromPath = (path) => path.split('.').reduce((obj, key) => obj[key], CONFIG.POS_PX);
return {
scaleX, scaleY, pageW_pt, pageH_pt, pxToPt,
getRect: (spec) => {
const pos = typeof spec === 'string' ? getPositionFromPath(spec) : spec;
let left_px = pos.left;
if (pos.right !== undefined && pos.left === undefined) {
left_px = CONFIG.BASE_PX.W - pos.right - pos.width;
}
return {
left:Â  Â left_px !== undefined ? pxToPt(left_px) * scaleX : undefined,
top:Â  Â  pos.top !== undefined ? pxToPt(pos.top) * scaleY : undefined,
width:Â  pos.width !== undefined ? pxToPt(pos.width) * scaleX : undefined,
height: pos.height !== undefined ? pxToPt(pos.height) * scaleY : undefined,
};
}
};
}

function offsetRect(rect, dx, dy) {
return { left: rect.left + (dx || 0), top: rect.top + (dy || 0), width: rect.width, height: rect.height };
}

function drawStandardTitleHeader(slide, layout, key, title) {
const logoRect = layout.getRect(`${key}.headerLogo`);
try {
Â  const logo = slide.insertImage(CONFIG.LOGOS.header);
Â  const asp = logo.getHeight() / logo.getWidth();
Â  logo.setLeft(logoRect.left).setTop(logoRect.top).setWidth(logoRect.width).setHeight(logoRect.width * asp);
} catch (e) {
Â  // ç”»åƒæŒ¿å…¥ã«å¤±æ•—ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ä»–ã®è¦ç´ ã‚’æç”»
}

const titleRect = layout.getRect(`${key}.title`);
const titleShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, titleRect.left, titleRect.top, titleRect.width, titleRect.height);
setStyledText(titleShape, title || '', { size: CONFIG.FONTS.sizes.contentTitle, bold: true });

const uRect = layout.getRect(`${key}.titleUnderline`);
const u = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, uRect.left, uRect.top, uRect.width, uRect.height);
u.getFill().setSolidFill(CONFIG.COLORS.primary_color);
u.getBorder().setTransparent();
}

function drawSubheadIfAny(slide, layout, key, subhead) {
if (!subhead) return 0;
const rect = layout.getRect(`${key}.subhead`);
const box = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, rect.left, rect.top, rect.width, rect.height);
setStyledText(box, subhead, { size: CONFIG.FONTS.sizes.subhead, color: CONFIG.COLORS.text_primary });
return layout.pxToPt(36);
}

function drawBottomBar(slide, layout) {
const barRect = layout.getRect('bottomBar');
const bar = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, barRect.left, barRect.top, barRect.width, barRect.height);
bar.getFill().setSolidFill(CONFIG.COLORS.primary_color);
bar.getBorder().setTransparent();
}

function drawBottomBarAndFooter(slide, layout, pageNum) {
drawBottomBar(slide, layout);
addCucFooter(slide, layout, pageNum);
}

function addCucFooter(slide, layout, pageNum) {
const leftRect = layout.getRect('footer.leftText');
const leftShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, leftRect.left, leftRect.top, leftRect.width, leftRect.height);
leftShape.getText().setText(CONFIG.FOOTER_TEXT);
applyTextStyle(leftShape.getText(), { size: CONFIG.FONTS.sizes.footer, color: CONFIG.COLORS.text_primary });

if (pageNum > 0) {
const rightRect = layout.getRect('footer.rightPage');
const rightShape = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, rightRect.left, rightRect.top, rightRect.width, rightRect.height);
rightShape.getText().setText(String(pageNum));
applyTextStyle(rightShape.getText(), { size: CONFIG.FONTS.sizes.footer, color: CONFIG.COLORS.primary_color, align: SlidesApp.ParagraphAlignment.END });
}
}

function applyTextStyle(textRange, opt) {
const style = textRange.getTextStyle();
style.setFontFamily(CONFIG.FONTS.family);
style.setForegroundColor(opt.color || CONFIG.COLORS.text_primary);
style.setFontSize(opt.size || CONFIG.FONTS.sizes.body);
style.setBold(opt.bold || false);
if (opt.align) {
try { textRange.getParagraphs().forEach(p => p.getRange().getParagraphStyle().setParagraphAlignment(opt.align)); } catch (e) {}
}
}

function setStyledText(shapeOrCell, rawText, baseOpt) {
const parsed = parseInlineStyles(rawText || '');
const tr = shapeOrCell.getText();
tr.setText(parsed.output);
applyTextStyle(tr, baseOpt || {});
applyStyleRanges(tr, parsed.ranges);
}

function setBulletsWithInlineStyles(shape, points) {
const joiner = '\n\n';
let combined = '';
const ranges = [];

(points || []).forEach((pt, idx) => {
const parsed = parseInlineStyles(String(pt || ''));
const bullet = 'â€¢ ' + parsed.output;
if (idx > 0) combined += joiner;
const start = combined.length;
combined += bullet;

parsed.ranges.forEach(r => {
Â  ranges.push({ start: start + 2 + r.start, end: start + 2 + r.end, bold: r.bold, color: r.color });
});
});

const tr = shape.getText();
tr.setText(combined || 'â€¢ â€”');
applyTextStyle(tr, { size: CONFIG.FONTS.sizes.body });

try {
tr.getParagraphs().forEach(p => {
const ps = p.getRange().getParagraphStyle();
ps.setLineSpacing(100);
ps.setSpaceBelow(6);
});
} catch (e) {}

applyStyleRanges(tr, ranges);
}

function parseInlineStyles(s) {
const ranges = [];
let out = '';
for (let i = 0; i < s.length; ) {
if (s[i] === '[' && s[i+1] === '[') {
const close = s.indexOf(']]', i + 2);
if (close !== -1) {
const content = s.substring(i + 2, close);
const start = out.length;
out += content;
const end = out.length;
ranges.push({ start, end, bold: true, color: CONFIG.COLORS.primary_color });
i = close + 2; continue;
}
}
if (s[i] === '*' && s[i+1] === '*') {
const close = s.indexOf('**', i + 2);
if (close !== -1) {
const content = s.substring(i + 2, close);
const start = out.length;
out += content;
const end = out.length;
ranges.push({ start, end, bold: true });
i = close + 2; continue;
}
}
out += s[i]; i++;
}
return { output: out, ranges };
}

function applyStyleRanges(textRange, ranges) {
ranges.forEach(r => {
try {
const sub = textRange.getRange(r.start, r.end);
if (!sub) return;
const st = sub.getTextStyle();
if (r.bold) st.setBold(true);
if (r.color) st.setForegroundColor(r.color);
} catch (e) {}
});
}

function normalizeImages(arr) {
return (arr || []).map(v => {
if (typeof v === 'string') return { url: v };
if (v && typeof v.url === 'string') return { url: v.url, caption: v.caption || '' };
return null;
}).filter(Boolean).slice(0, 6);
}

function renderImagesInArea(slide, layout, area, images) {
if (!images || images.length === 0) return;
const n = Math.min(6, images.length);
let cols = 1, rows = 1;
if (n === 1) { cols = 1; rows = 1; }
else if (n === 2) { cols = 2; rows = 1; }
else if (n <= 4) { cols = 2; rows = 2; }
else { cols = 3; rows = 2; }

const gap = layout.pxToPt(10);
const cellW = (area.width - gap * (cols - 1)) / cols;
const cellH = (area.height - gap * (rows - 1)) / rows;

for (let i = 0; i < n; i++) {
const r = Math.floor(i / cols), c = i % cols;
const left = area.left + c * (cellW + gap);
const topÂ  = area.topÂ  + r * (cellH + gap);
try {
const img = slide.insertImage(images[i].url);
const scale = Math.min(cellW / img.getWidth(), cellH / img.getHeight());
const w = img.getWidth() * scale;
const h = img.getHeight() * scale;
img.setWidth(w).setHeight(h);
img.setLeft(left + (cellW - w) / 2).setTop(top + (cellH - h) / 2);
} catch(e) {}
}
}

function isAgendaTitle(title) {
const t = String(title || '').toLowerCase();
return /(agenda|ã‚¢ã‚¸ã‚§ãƒ³ãƒ€|ç›®æ¬¡|æœ¬æ—¥ãŠä¼ãˆã™ã‚‹ã“ã¨)/.test(t);
}

function buildAgendaFromSlideData() {
const pts = [];
for (const d of slideData) {
if (d && d.type === 'section' && typeof d.title === 'string' && d.title.trim()) pts.push(d.title.trim());
}
if (pts.length > 0) return pts.slice(0, 5);
const alt = [];
for (const d of slideData) {
if (d && d.type === 'content' && typeof d.title === 'string' && d.title.trim()) alt.push(d.title.trim());
}
return alt.slice(0, 5);
}

function drawNumberedItems(slide, layout, area, items) {
const n = Math.max(1, items.length);
const topPadding = layout.pxToPt(30);
const bottomPadding = layout.pxToPt(10);
const drawableHeight = area.height - topPadding - bottomPadding;
const gapY = drawableHeight / Math.max(1, n - 1);
const cx = area.left + layout.pxToPt(44);
const top0 = area.top + topPadding;

for (let i = 0; i < n; i++) {
const cy = top0 + gapY * i;
const sz = layout.pxToPt(28);
const numBox = slide.insertShape(SlidesApp.ShapeType.RECTANGLE, cx - sz/2, cy - sz/2, sz, sz);
numBox.getFill().setSolidFill(CONFIG.COLORS.primary_color);
numBox.getBorder().setTransparent();
const num = numBox.getText(); num.setText(String(i + 1));
applyTextStyle(num, { size: 12, bold: true, color: CONFIG.COLORS.background_white, align: SlidesApp.ParagraphAlignment.CENTER });

// å…ƒã®ç®‡æ¡æ›¸ããƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å…ˆé ­ã®æ•°å­—ã‚’é™¤å»
let cleanText = String(items[i] || '');
cleanText = cleanText.replace(/^\s*\d+[\.\s]*/, '');

const txt = slide.insertShape(SlidesApp.ShapeType.TEXT_BOX, cx + layout.pxToPt(28), cy - layout.pxToPt(16), area.width - layout.pxToPt(70), layout.pxToPt(32));
setStyledText(txt, cleanText, { size: CONFIG.FONTS.sizes.processStep });
try { txt.setContentAlignment(SlidesApp.ContentAlignment.MIDDLE); } catch(e){}
}
}
